<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>KPGU Assistant üéì</title>
    <!-- Tailwind CSS (CDN) -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Marked (CDN for Markdown) -->
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Outfit', sans-serif; }
        .scrollbar-thin::-webkit-scrollbar { width: 6px; }
        .scrollbar-thin::-webkit-scrollbar-thumb { background: rgba(0,0,0,0.1); border-radius: 10px; }
        .prose ul { list-style-type: disc; padding-left: 1.25rem; }
        .prose ol { list-style-type: decimal; padding-left: 1.25rem; }
        .message-bubble { max-width: 85%; }
        @media (min-width: 768px) { .message-bubble { max-width: 75%; } }
    </style>
</head>
<body class="bg-gray-900 overflow-hidden">
    <div class="relative flex flex-col h-[100dvh] w-full bg-cover bg-center" style="background-image: url('https://images.unsplash.com/photo-1541339907198-e08756ebafe3?q=80&w=2070&auto=format&fit=crop');">
        <!-- Overlay -->
        <div class="absolute inset-0 bg-black/70 backdrop-blur-sm z-0"></div>

        <!-- Main Container -->
        <div class="relative z-10 flex flex-col h-full md:h-[90vh] md:w-[90vw] md:max-w-5xl md:mx-auto md:my-auto bg-white/5 backdrop-blur-md md:border border-white/20 md:rounded-2xl shadow-2xl overflow-hidden">
            
            <!-- Header -->
            <div class="flex items-center justify-between px-6 py-4 bg-[#003366]/90 border-b border-white/10 text-white">
                <div class="flex items-center gap-4">
                    <div class="w-12 h-12 bg-white rounded-full flex items-center justify-center overflow-hidden border-2 border-[#CC0000]">
                        <img src="https://kpgu.ac.in/wp-content/uploads/2021/07/KPGU-Logo-1.png" alt="KPGU" class="object-contain w-10 h-10" id="logo-img">
                    </div>
                    <div>
                        <h1 class="text-xl font-bold tracking-wide">KPGU Assistant</h1>
                        <p class="text-xs text-gray-300 font-light">Drs. Kiran & Pallavi Patel Global University</p>
                    </div>
                </div>
                <div class="flex items-center gap-2">
                    <span class="w-2.5 h-2.5 bg-green-500 rounded-full animate-pulse shadow-lg shadow-green-500/50"></span>
                    <span class="text-sm font-medium text-white/90">Online</span>
                </div>
            </div>

            <!-- Chat Area -->
            <div id="chat-area" class="flex-1 overflow-y-auto p-6 space-y-6 scrollbar-thin">
                <!-- Welcome Message -->
                <div class="flex justify-start w-full">
                    <div class="flex gap-3 flex-row">
                        <div class="w-10 h-10 rounded-full bg-[#003366] text-white flex items-center justify-center shrink-0 shadow-lg border-2 border-white/20">
                            <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 24 24"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-1 14H9v-2h2v2zm0-4H9V7h2v5z" /></svg>
                        </div>
                        <div class="message-bubble relative p-4 rounded-2xl shadow-md text-base bg-white/95 text-gray-800 rounded-tl-none border border-white/50">
                            <div class="prose prose-sm prose-slate max-w-none">
                                Hello! üëã I am KPGU Assistant, here to help you with information about KPGU Vadodara. How can I assist you today? üéì‚ú®
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Loading Indicator (Hidden) -->
            <div id="loading" class="hidden px-6 py-2">
                <div class="flex justify-start w-full animate-pulse">
                    <div class="flex gap-3 flex-row">
                        <div class="w-10 h-10 rounded-full bg-[#003366] flex items-center justify-center shrink-0 border-2 border-white/20 text-white text-xs">‚è≥</div>
                        <div class="bg-white/90 p-3 rounded-2xl rounded-tl-none border border-white/50 shadow-sm flex items-center gap-1.5">
                            <span class="w-2 h-2 bg-gray-400 rounded-full animate-bounce"></span>
                            <span class="w-2 h-2 bg-gray-400 rounded-full animate-bounce" style="animation-delay: 0.2s"></span>
                            <span class="w-2 h-2 bg-gray-400 rounded-full animate-bounce" style="animation-delay: 0.4s"></span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Input Area -->
            <div class="p-4 bg-white/90 border-t border-gray-200/50">
                <div class="flex items-center gap-3 max-w-4xl mx-auto">
                    <input type="text" id="chat-input" class="flex-1 px-6 py-4 rounded-full border border-gray-300 focus:outline-none focus:border-[#003366] focus:ring-4 focus:ring-[#003366]/10 transition-all font-medium text-gray-800" placeholder="Ask anything about KPGU...">
                    <button id="send-btn" class="bg-gradient-to-r from-[#CC0000] to-[#990000] text-white p-4 rounded-full shadow-lg hover:scale-105 active:scale-95 transition-all flex items-center justify-center">
                        <svg class="w-6 h-6 ml-0.5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 19l9 2-9-18-9 18 9-2zm0 0v-8" /></svg>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        const chatArea = document.getElementById('chat-area');
        const chatInput = document.getElementById('chat-input');
        const sendBtn = document.getElementById('send-btn');
        const loading = document.getElementById('loading');

        function appendMessage(text, sender, language = 'en') {
            const div = document.createElement('div');
            div.className = `flex w-full ${sender === 'user' ? 'justify-end' : 'justify-start'}`;
            
            const isUser = sender === 'user';
            const bubbleBg = isUser ? 'bg-gradient-to-br from-[#CC0000] to-[#b30000] text-white rounded-tr-none border border-red-800/50' : 'bg-white/95 text-gray-800 rounded-tl-none border border-white/50';
            const iconBg = isUser ? 'bg-[#CC0000]' : 'bg-[#003366]';
            const icon = isUser ? '<svg class="w-5 h-5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" /></svg>' : '<svg class="w-6 h-6 text-white" fill="currentColor" viewBox="0 0 24 24"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-1 14H9v-2h2v2zm0-4H9V7h2v5z" /></svg>';

            div.innerHTML = `
                <div class="flex ${isUser ? 'flex-row-reverse' : 'flex-row'} gap-3 message-bubble">
                    <div class="w-10 h-10 rounded-full ${iconBg} flex items-center justify-center shrink-0 shadow-lg border-2 border-white/20">
                        ${icon}
                    </div>
                    <div class="relative p-4 rounded-2xl shadow-md text-base leading-relaxed ${bubbleBg}">
                        <div class="prose prose-sm max-w-none ${isUser ? 'text-white' : 'text-gray-800'}">
                            ${isUser ? text : marked.parse(text)}
                        </div>
                        ${!isUser ? `
                        <div class="mt-3 flex items-center justify-between border-t border-gray-100/50 pt-2">
                            <span class="px-2 py-0.5 text-[10px] font-bold uppercase tracking-wider rounded bg-[#003366]/10 text-[#003366] border border-[#003366]/20">
                                ${language === 'gu' ? 'GUJARATI' : language === 'hi' ? 'HINDI' : 'ENGLISH'}
                            </span>
                            <span class="text-[10px] text-gray-400 italic flex items-center gap-1">
                                <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 011.414.586l4 4a1 1 0 01.586 1.414V19a2 2 0 01-2 2z" /></svg>
                                KPGU Knowledge Base
                            </span>
                        </div>` : ''}
                    </div>
                </div>
            `;
            chatArea.appendChild(div);
            chatArea.scrollTop = chatArea.scrollHeight;
        }

        async function handleSend() {
            const query = chatInput.value.trim();
            if (!query) return;

            appendMessage(query, 'user');
            chatInput.value = '';
            loading.classList.remove('hidden');
            chatArea.scrollTop = chatArea.scrollHeight;

            try {
                const response = await fetch('/api/v1/chat/', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ query: query })
                });
                const data = await response.json();
                loading.classList.add('hidden');
                appendMessage(data.response, 'bot', data.detected_language);
            } catch (error) {
                loading.classList.add('hidden');
                appendMessage('‚ö†Ô∏è Connection Error: Please ensure the server is running.', 'bot');
            }
        }

        sendBtn.addEventListener('click', handleSend);
        chatInput.addEventListener('keypress', (e) => { if (e.key === 'Enter') handleSend(); });
    </script>
</body>
</html>
